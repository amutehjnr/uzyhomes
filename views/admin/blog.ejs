<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> ‚Äî UZYHOMES Admin</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Admin CSS -->
    <link rel="stylesheet" href="/css/admin.css">
    
    <style>
        .blog-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .blog-table th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #2D2D2D;
            border-bottom: 2px solid #E8E4DD;
            padding: 1rem;
        }
        
        .blog-table td {
            padding: 1rem;
            vertical-align: middle;
            border-bottom: 1px solid #E8E4DD;
            color: #777777;
        }
        
        .blog-table tr:hover {
            background: #FAF9F7;
        }
        
        .post-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .post-info {
            display: flex;
            flex-direction: column;
        }
        
        .post-title a {
            color: #2D2D2D;
            text-decoration: none;
            font-weight: 500;
        }
        
        .post-title a:hover {
            color: #A68A6F;
        }
        
        .post-slug {
            font-size: 0.8rem;
            color: #999;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-secondary {
            background: #e9ecef;
            color: #6c757d;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .featured-star {
            cursor: pointer;
            font-size: 1.2rem;
            color: #ffc107;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-ghost {
            background: transparent;
            border: 1px solid #E8E4DD;
            color: #777;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .btn-ghost:hover {
            background: #2D2D2D;
            color: white;
            border-color: #2D2D2D;
        }
        
        .bulk-actions {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 1rem;
            border: 1px solid #A68A6F;
        }
        
        .bulk-actions.show {
            display: flex;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #E8E4DD;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: #A68A6F;
        }
        
        .stat-label {
            color: #777;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #E8E4DD;
            background: white;
            color: #777;
            transition: all 0.3s ease;
        }
        
        .page-btn:hover {
            background: #2D2D2D;
            color: white;
            border-color: #2D2D2D;
        }
        
        .page-btn.active {
            background: #A68A6F;
            color: white;
            border-color: #A68A6F;
        }
    </style>
</head>
<body class="admin-panel" data-page="blog">
    <%- include('partials/header') %>
    
    <div class="admin-wrapper">
        <%- include('partials/sidebar') %>
        
        <main class="admin-main">
            <div class="admin-container">
                <!-- Page Header -->
                <div class="page-header mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="page-title">Blog Posts</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
                                    <li class="breadcrumb-item active">Blog</li>
                                </ol>
                            </nav>
                        </div>
                        <a href="/admin/blog/new" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>New Post
                        </a>
                    </div>
                </div>
                
                <!-- Flash Messages -->
                <% if (messages && messages.success) { %>
                    <div class="alert alert-success alert-dismissible fade show">
                        <i class="fas fa-check-circle me-2"></i><%= messages.success %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <% } %>
                <% if (messages && messages.error) { %>
                    <div class="alert alert-danger alert-dismissible fade show">
                        <i class="fas fa-exclamation-circle me-2"></i><%= messages.error %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <% } %>
                
                <!-- Stats Cards -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number"><%= stats?.total || 0 %></div>
                            <div class="stat-label">Total Posts</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number"><%= stats?.published || 0 %></div>
                            <div class="stat-label">Published</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number"><%= stats?.draft || 0 %></div>
                            <div class="stat-label">Drafts</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number"><%= stats?.featured || 0 %></div>
                            <div class="stat-label">Featured</div>
                        </div>
                    </div>
                </div>
                
                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="blogSearch" data-search="blog" placeholder="Search posts..." value="<%= filters?.search || '' %>">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="blogStatus" data-filter="blog">
                                <option value="all">All Status</option>
                                <option value="published" <%= filters?.status === 'published' ? 'selected' : '' %>>Published</option>
                                <option value="draft" <%= filters?.status === 'draft' ? 'selected' : '' %>>Draft</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="blogCategory" data-filter="blog">
                                <option value="all">All Categories</option>
                                <option value="interior-design" <%= filters?.category === 'interior-design' ? 'selected' : '' %>>Interior Design</option>
                                <option value="quiet-luxury" <%= filters?.category === 'quiet-luxury' ? 'selected' : '' %>>Quiet Luxury</option>
                                <option value="home-styling" <%= filters?.category === 'home-styling' ? 'selected' : '' %>>Home Styling</option>
                                <option value="behind-the-scenes" <%= filters?.category === 'behind-the-scenes' ? 'selected' : '' %>>Behind the Scenes</option>
                                <option value="client-stories" <%= filters?.category === 'client-stories' ? 'selected' : '' %>>Client Stories</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-secondary w-100" onclick="Blog.filter()">
                                <i class="fas fa-search me-2"></i>Filter
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Bulk Actions -->
                <div class="bulk-actions" id="bulkActions">
                    <span class="fw-bold"><span id="selectedCount">0</span> selected:</span>
                    <button class="btn btn-sm btn-success" onclick="Blog.bulkPublish()">
                        <i class="fas fa-check-circle me-1"></i>Publish
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="Blog.bulkUnpublish()">
                        <i class="fas fa-eye-slash me-1"></i>Unpublish
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="Blog.bulkDelete()">
                        <i class="fas fa-trash me-1"></i>Delete
                    </button>
                    <button class="btn btn-sm btn-outline-secondary ms-auto" onclick="Blog.clearSelection()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Blog Table -->
                <div class="blog-table">
                    <table class="table mb-0">
                        <thead>
                            <tr>
                                <th width="40">
                                    <input type="checkbox" id="selectAll" onchange="Blog.selectAll()">
                                </th>
                                <th>Image</th>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Featured</th>
                                <th>Views</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blogTableBody">
                            <% if (posts && posts.length > 0) { %>
                                <% posts.forEach(p => { %>
                                    <tr>
                                        <td>
                                            <input type="checkbox" class="post-checkbox" value="<%= p._id %>" onchange="Blog.updateBulkActions()">
                                        </td>
                                        <td>
                                            <img src="<%= p.featured_image || '/images/placeholder.jpg' %>" class="post-thumb" alt="<%= p.title %>">
                                        </td>
                                        <td>
                                            <div class="post-info">
                                                <div class="post-title">
                                                    <a href="/admin/blog/<%= p._id %>/edit"><%= p.title %></a>
                                                </div>
                                                <div class="post-slug">/<%= p.slug %></div>
                                            </div>
                                        </td>
                                        <td><%= p.author_name || 'Admin' %></td>
                                        <td><%= p.category || '‚Äî' %></td>
                                        <td><%= new Date(p.publishedAt).toLocaleDateString() %></td>
                                        <td>
                                            <span class="badge <%= p.isPublished ? 'badge-success' : 'badge-secondary' %>">
                                                <%= p.isPublished ? 'Published' : 'Draft' %>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="featured-star" onclick="Blog.toggleFeatured('<%= p._id %>')">
                                                <%= p.isFeatured ? '‚òÖ' : '‚òÜ' %>
                                            </span>
                                        </td>
                                        <td><%= p.views || 0 %></td>
                                        <td>
                                            <div class="action-buttons">
                                                <a href="/blog/<%= p.slug %>" class="btn btn-sm btn-ghost" target="_blank" title="View">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a href="/admin/blog/<%= p._id %>/edit" class="btn btn-sm btn-ghost" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <button class="btn btn-sm btn-ghost text-danger" 
                                                        onclick="Blog.confirmDelete('<%= p._id %>', '<%= p.title.replace(/'/g, "\\'") %>')" 
                                                        title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="10" class="text-center py-5">
                                        <div class="empty-state">
                                            <div class="empty-icon">üìù</div>
                                            <div class="empty-title">No blog posts found</div>
                                            <p class="empty-text">Get started by writing your first blog post.</p>
                                            <a href="/admin/blog/new" class="btn btn-primary mt-3">
                                                <i class="fas fa-plus me-2"></i>Create First Post
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <% if (pagination && pagination.totalPages > 1) { %>
                    <div class="pagination">
                        <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                            <a href="/admin/blog?page=<%= i %><%= filters?.status !== 'all' ? '&status=' + filters.status : '' %><%= filters?.category !== 'all' ? '&category=' + filters.category : '' %>" 
                               class="page-btn <%= i === pagination.page ? 'active' : '' %>">
                                <%= i %>
                            </a>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </main>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalTitle">Delete Blog Post</h5>
                <button class="modal-close" onclick="Modal.close('deleteModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="deleteTargetName"></strong>? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" onclick="Modal.close('deleteModal')">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDeleteAction()">Delete</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/admin.js"></script>
</body>
</html>